# CHANGELOG - 2026-01-28 (Windows API Detection)

## 追加機能：Windows API判定機能の実装

### 概要
Import tableから確実にWindows APIを取得し、UI表示用のフラグを生成する機能を実装。

### 変更内容

#### 1. ExtractAnalysis.java（Ghidraスクリプト）

**新規追加クラス・メソッド**:
- `ImportInfo` クラス：Import情報（DLL名、アドレス、Windows APIフラグ）を保持
- `FunctionMeta` クラス：関数メタデータを保持
- `isWindowsDLL(String lib)`: Windows DLL判定（kernel32, user32, advapi32など20種類以上対応）
- `extractImports()`: ExternalManagerを使用してImport tableを抽出

**判定ロジック（3段階）**:
1. **Import mapに直接存在** → 100%確実
2. **Thunk関数** + 名前パターン解析 → 95%確実
3. **External flag** → 参考程度

**追加フィールド**:
- `is_external`: 外部関数かどうか
- `is_winapi`: Windows APIかどうか
- `is_thunk`: Thunk関数かどうか
- `dll`: 所属DLL名（外部関数の場合）

**JSON出力**:
- 新規セクション：`imports[]` - Import table全体（DLL別にグループ化）
- 各関数に上記4フィールドを追加

### 既存機能（変更なし）
- Frontend（App.tsx）：既に `is_winapi` / `is_external` の表示ロジック実装済み
  - 青色タグ（`#4da3ff`）で「Win API」表示
- Backend（app.py）：analysis.jsonをそのまま返すだけなので変更不要

### 対応Windows DLL一覧
- kernel32, user32, advapi32, ntdll, msvcrt
- gdi32, ws2_32, shell32, ole32, comctl32
- comdlg32, shlwapi, wininet, crypt32, bcrypt
- secur32, winmm, version, iphlpapi, winsock
- API-MS-WIN-* (Windows 10+ API sets)
- ucrt, vcruntime系

### テスト方法
```bash
cd ~/ghidrauto-llm
# 既存ジョブで再extract
curl -X POST http://localhost:8000/api/jobs/<job_id>/reextract
# または新規アップロード
```

UIで関数リストを確認し、Windows API関数に青色「Win API」タグが表示されることを確認。

### 制限事項
- 動的に解決されるAPIは検出不可（静的解析の限界）
- IAT経由の間接呼び出しはImport tableに存在すれば検出可能
